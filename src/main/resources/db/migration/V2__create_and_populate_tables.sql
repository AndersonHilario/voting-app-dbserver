CREATE TABLE associate
(
    id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    cpf  VARCHAR(11)  NOT NULL UNIQUE
);

CREATE TABLE agenda
(
    id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_by_id BIGINT,
    name          VARCHAR(255) NOT NULL,
    description   TEXT,
    CONSTRAINT fk_created_by FOREIGN KEY (created_by_id) REFERENCES associate (id)
);

CREATE TABLE voting_session
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    agenda_id   BIGINT    NOT NULL,
    status      VARCHAR(20) DEFAULT 'IN_PROGRESS',
    created_at  TIMESTAMP NOT NULL,
    name        VARCHAR(255),
    description TEXT,
    time_limit  INTEGER,
    closed_at   TIMESTAMP,
    CONSTRAINT fk_agenda FOREIGN KEY (agenda_id) REFERENCES agenda (id)
);

-- Criação da tabela vote
CREATE TABLE vote
(
    id                BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    voting_session_id BIGINT      NOT NULL,
    associate_id      BIGINT      NOT NULL,
    vote_type         VARCHAR(10) NOT NULL,
    voted_at          TIMESTAMP   NOT NULL,
    CONSTRAINT fk_voting_session FOREIGN KEY (voting_session_id) REFERENCES voting_session (id),
    CONSTRAINT fk_associate FOREIGN KEY (associate_id) REFERENCES associate (id),
    CONSTRAINT uc_voting_session_associate UNIQUE (voting_session_id, associate_id)
);

INSERT INTO associate (id, name, cpf)
VALUES (1, 'João Silva', '12345678901'),
       (2, 'Maria Oliveira', '98765432100'),
       (3, 'José Santos', '45678912300');

INSERT INTO agenda (id, created_by_id, name, description)
VALUES (1, 3, 'Agenda 1', 'Agenda 1 description'),
       (2, 2, 'Agenda 2', 'Agenda 2 description'),
       (3, 1, 'Agenda 3', 'Agenda 3 description');

INSERT INTO voting_session (id, agenda_id, status, created_at, name, description, time_limit, closed_at)
VALUES (1, 1, 'IN_PROGRESS', '2024-10-01 09:00:00', 'Regular Session', 'Discussion of reforms', 120,
        '2024-10-01 17:00:00'),
       (2, 2, 'FINISHED', '2024-09-25 14:00:00', 'Extraordinary Session', 'Emergency voting', 60,
        '2024-09-25 15:00:00');

INSERT INTO vote (id, voting_session_id, associate_id, vote_type, voted_at)
VALUES (1, 1, 3, 'FAVOR', '2024-10-01 09:30:00'),
       (2, 1, 2, 'AGAINST', '2024-10-01 10:00:00'),
       (3, 2, 2, 'FAVOR', '2024-09-25 14:05:00');
